<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
        integrity="sha512-iecdLmaskl7CVkqkXNQ/ZH/XLlvWZOJyj7Yy7tcenmpD1ypASozpmT/E0iPtmFIB46ZmdtAc9eNBvH0H/ZpiBw=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@20..48,100..700,0..1,-50..200" />
    <link rel="stylesheet" href="css/pgCliente.css">
    <link rel="stylesheet" href="./css/modal.css">
    <script src="./javascript/cadastro/cliente.js"></script> 
    <title>Área do Cliente</title>
    <link rel="shortcut icon" href="assets2/pagina_inicial/logo.png" type="image/x-icon" />
    <script src="https://kit.fontawesome.com/390ed0de69.js" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/node-forge@1.0.0/dist/forge.min.js"></script>

</head>
</head>

<body>
    <header>
        <nav class="navbar">
            <figure class="logo">
                <a href="./index.html#home">
                    <img src="assets2/pagina_inicial/Logo_mais_texto.png" alt="">
                </a>
            </figure>
            <ul class="lista">
                <a href=""></a>
                <li>
                    <a href="./index.html#home">
                        Home
                        <div class="bar"></div>
                    </a>
                </li>
                <li>
                    <a href="./index.html#sobrenos">
                        Sobre nós
                        <div class="bar"></div>
                    </a>
                </li>
                <li>
                    <a href="./index.html#contato">
                        Contato
                        <div class="bar"></div>
                    </a>
                </li>
                <li>
                    <a href="./cliente.html" class="dashboard_texto">
                        Dashboard
                        <div class="dashboard_bar">
                            <div class="little-bar"></div>
                        </div>
                    </a>
                </li>
            </ul>
        </nav>
    </header>

    <div class="container">
        <div class="box">
            <div class="container-box">
                <div class="row-title">
                    <span class="material-symbols-outlined">person_add</span>
                    <span class="title">Cadastre-se</span>
                </div>
                <input maxlength="14" type="text" placeholder="CNPJ da empresa" class="input-form" id="input_cnpj_cadastro">
                <input maxlength="11" type="text" placeholder="CPF" class="input-form" id="input_cpf_cadastro">
                <input maxlength="45" type="text" placeholder="Nome" class="input-form" id="input_nome_cadastro">
                <input maxlength="13" type="text" placeholder="Celular" class="input-form" id="input_celular_cadastro">
                <input maxlength="80" type="email" placeholder="Email" class="input-form" id="input_email_cadastro">
                <input maxlength="120" type="password" placeholder="Senha" class="input-form" id="input_senha_cadastro">
                <div class="row-text-login">
                    <span class="span-row-text-login" onclick="moveImageLeft()">Já tem conta? Faça login</span>
                </div>
                <button class="btn btn-enviar" onclick="cadastrar()">Cadastrar</button>
            </div>
        </div>

        <div class="box">
            <div class="container-box">
                <div class="row-title">
                    <span class="material-symbols-outlined">person</span>
                    <span class="title">Login</span>
                </div>
                <input type="text" placeholder="Email" class="input-form" id="input_email_login">
                <input type="password" placeholder="Senha" class="input-form" id="input_senha_login">
                <span class="span-cad" onclick="moveImageRigth()">Cadastre-se</span>
                <button class="btn" onclick="entrar()">Entrar</button>
            </div>
        </div>
    </div>

    <div class="image-area" id="image-area">
        <img src="assets2/pagina_inicial/logoEmpresa.png">
    </div>

    <footer class="footer" id="contato">
        <h1 class="Texto_footer">
            Rua Haddock Lobo, 595 - Cerqueira César, <br />São Paulo - SP,
            01414-001
        </h1>
        <div class="social">
            <a href="mailto: support@analyticalsolutionstech.zohodesk.com">
                <i id="zap" class="fa-solid fa-envelope"></i>
            </a>
            <a href="">
                <i id="link" class="fa-brands fa-linkedin"></i>
            </a>
            <a href="">
                <i id="insta" class="fa-brands fa-instagram"></i>
            </a>
        </div>
    </footer>
    <div class="modal_container" id="modal_container">
        <div class="modal_body">
            <img class="modal_img" src="./assets/avisoerro.png" alt="Alerta">
            <h1 class="modal_titulo" id="modal_titulo">
                Erro ao fazer login
            </h1>
            <span class="modal_txt" id="modal_txt">Verfifique se o email e a senha estão corretos e tente
                novamente</span>
            <button class="modal_btn" onclick="disableModal()">
                OK
            </button>
        </div>
    </div>

</body>

</html>

<script>
    var divImage = document.getElementById("image-area");

    function moveImageRigth() {
        divImage.style.width = '100%';
        setTimeout(function () {
            divImage.classList.add("right-value");
            divImage.classList.remove("left-value");
            divImage.style.width = '50%';
        }, 500);
    }

    function moveImageLeft() {
        divImage.style.width = '100%';
        setTimeout(function () {
            divImage.classList.add("left-value");
            divImage.classList.remove("right-value");
            divImage.style.width = '50%';
        }, 500);
    }
</script>



<script>

    function entrar() {

        var emailVar = input_email_login.value;

        var senhaCript = forge.md.sha256.create();
        senhaCript.update(`${input_senha_login.value}`);
        //console.log(senhaVar.digest().toHex());
        var senhaVar = senhaCript.digest().toHex();

        if (emailVar == "" || senhaVar == "") {
            modal_container.style.display = "flex";
            modal_titulo.innerHTML = "Erro ao fazer login"
            modal_txt.innerHTML = "Verfifique se o email e a senha estão corretos e tente novamente"
            return false;
            
        }
        
        else {
            setInterval(sumirMensagem, 5000)
        }

        console.log("FORM LOGIN: ", emailVar);
        console.log("FORM SENHA: ", senhaVar);

        fetch("/usuarios/autenticar", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                emailServer: emailVar,
                senhaServer: senhaVar
            })

        }).then(function (resposta) {
            console.log("ESTOU NO THEN DO entrar()!")

            if (resposta.ok) {
                console.log(resposta);

                resposta.json().then(json => {
                    console.log(json);
                    console.log(JSON.stringify(json));

                    sessionStorage.EMAIL_USUARIO = json.email;
                    sessionStorage.NOME_USUARIO = json.nome;
                    sessionStorage.ID_USUARIO = json.id;

                    setTimeout(function () {
                        window.location = "./dashboard.html";
                    }, 1000); // apenas para exibir o loading

                });

            } else {

                console.log("Houve um erro ao tentar realizar o login!");
                console.log(modal_container);
                console.log(modal_titulo);
                console.log(modal_txt);

                modal_container.style.display = "flex";
                modal_titulo.innerHTML = "Erro ao fazer login"
                modal_txt.innerHTML = "Verfifique se o email e a senha estão corretos e tente novamente"

                resposta.text().then(texto => {
                    console.error(texto);
                });
            }

        }).catch(function (erro) {
            console.log(erro);
        })

        return false;
    }

    function sumirMensagem() {
    }

    function cadastrar() {


        var var_cnpj = input_cnpj_cadastro.value ;
        var var_cpf= input_cpf_cadastro.value ;
        var var_nome = input_nome_cadastro.value ;
        var var_celular = input_celular_cadastro.value ;
        var var_email = input_email_cadastro.value ;

        var senha_cript = forge.md.sha256.create();
        senha_cript.update(`${input_senha_cadastro.value}`);
        var var_senha = senha_cript.digest().toHex();

        //Recupere o valor da nova input pelo nome do id
        // Agora vá para o método fetch logo abaixo
        

        if (var_nome == "" || var_email == "" || var_senha == "" || var_celular == "" || var_cpf == ""|| var_cnpj == "") {

            return console.log('Verifique se os campos do cadastro não estão vazios');
        }
        else {
            setInterval(sumirMensagem, 5000)
        }

        // Enviando o valor da nova input
        fetch("/usuarios/cadastrar", {
            method: "POST",
            headers: {
                "Content-Type": "application/json"
            },
            body: JSON.stringify({
                // crie um atributo que recebe o valor recuperado aqui
                // Agora vá para o arquivo routes/usuario.js
                nomeServer: var_nome,
                emailServer: var_email,
                senhaServer: var_senha,
                celularServer: var_celular,
                cnpjServer: var_cnpj,
                cpfServer: var_cpf,
            })
        }).then(function (resposta) {

            console.log("resposta: ", resposta);

            if (resposta.ok) {


                setTimeout(() => {
                    window.location = "./dashboard.html";
                }, "2000")

                limparFormulario();
                finalizarAguardar();
            } else {
                throw ("Houve um erro ao tentar realizar o cadastro!");
            }
        }).catch(function (resposta) {
            console.log(`#ERRO: ${resposta}`);
        });

        return false;
    }


</script>